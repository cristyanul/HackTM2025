<!-- public_resources_map/templates/admin_list.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Admin • List view</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-6">
  <header class="mb-6 flex justify-between">
    <h1 class="text-2xl font-semibold">All Places</h1>
    <a href="/admin/" class="underline">Back to map</a>
  </header>

  <table class="min-w-full border border-gray-300">
    <thead class="bg-gray-100 text-left">
      <tr>
        <th class="border px-2 py-1">ID</th>
        <th class="border px-2 py-1">Name</th>
        <th class="border px-2 py-1">Type</th>
        <th class="border px-2 py-1">Capacity</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <div class="mt-4">
    <button id="loadMore"
            class="px-4 py-2 bg-blue-600 text-white rounded">
      Load more
    </button>
    <span id="noneMsg" class="ml-4 text-gray-600 hidden">
      — no more rows —
    </span>
  </div>

  <script>
    let offset = 0;
    const limit  = 20;
    const tbody  = document.getElementById("tbody");
    const loadBtn= document.getElementById("loadMore");
    const noneMsg= document.getElementById("noneMsg");

    function addRows(rows){
      rows.forEach(p=>{
        const tr=document.createElement("tr");
        tr.innerHTML=`
          <td class="border px-2 py-1">${p.id}</td>
          <td class="border px-2 py-1">${p.name}</td>
          <td class="border px-2 py-1">${p.type}</td>
          <td class="border px-2 py-1">${p.capacity}</td>`;
        tbody.appendChild(tr);
      });
    }

    function load(){
      fetch(`/admin/api/places?offset=${offset}&limit=${limit}`)
        .then(r=>r.json())
        .then(data=>{
          addRows(data);
          offset += data.length;
          if(data.length < limit){
            loadBtn.disabled = true;
            noneMsg.classList.remove("hidden");
          }
        })
        .catch(err=>{
          console.error(err);
          alert("Failed to load rows. See console for details.");
        });
    }

    // initial batch + button handler
    load();
    loadBtn.addEventListener("click", load);
  </script>
</body>
</html>
